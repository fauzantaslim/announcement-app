# Digital Announcement System

A web-based digital announcement system using Docker, Laravel (API), Next.js (Frontend), MySQL (Database), and Nginx (Gateway & Asset Server).

## ğŸ“‹ Table of Contents

- [System Architecture](#system-architecture)
- [Technology Stack](#technology-stack)
- [Project Structure](#project-structure)
- [Prerequisites](#prerequisites)
- [Installation & Setup](#installation--setup)
- [How to Run](#how-to-run)
- [Application Features](#application-features)
- [API Documentation](#api-documentation)
- [Troubleshooting](#troubleshooting)

## ğŸ—ï¸ System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      User Browser                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  Gateway (Nginx)       â”‚
         â”‚  pengumuman.test       â”‚
         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚          â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â–¼                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ UI      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ API      â”‚
â”‚ Next.js â”‚   API Calls      â”‚ Laravel  â”‚â”€â”€â”€â”
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â”‚
     â”‚                            â”‚         â”‚
     â”‚                            â–¼         â”‚
     â”‚                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
     â”‚                       â”‚ MySQL   â”‚    â”‚
     â”‚                       â”‚ DB      â”‚    â”‚
     â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
     â”‚                                      â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Assets   â”‚
              â”‚ Nginx    â”‚ (Serve uploaded images)
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Workflow:**
1. **User** â†’ Access via **Gateway** (pengumuman.test)
2. **Gateway** â†’ Route to **UI** (pages) or **API** (endpoints)
3. **UI** â†â†’ **API** â†’ Communication for CRUD operations
4. **API** â†’ **Database** â†’ Store/retrieve announcements data
5. **API** â†’ **Assets** â†’ Upload announcement images
6. **UI** â†’ **Assets** â†’ Load images for display

## ğŸ› ï¸ Technology Stack

### Backend (API)
- **Laravel 11** - PHP Framework
- **MySQL 8** - Database
- **Sanctum** - API Authentication

### Frontend (UI)
- **Next.js 16** - React Framework
- **React 19** - UI Library
- **TypeScript** - Type Safety
- **Tailwind CSS** - Styling
- **Axios** - HTTP Client
- **React-Quill-New** - Rich Text Editor

### Infrastructure
- **Docker & Docker Compose** - Containerization
- **Nginx** - Reverse Proxy & Static File Server
- **phpMyAdmin** - Database Management

## ğŸ“ Project Structure

```
tgs-p13/
â”œâ”€â”€ api-digital-announce-system/          # Laravel API Backend
â”‚   â””â”€â”€ digital-announce-system/
|   â””â”€â”€ nginx/
|       â””â”€â”€ default.conf
|   â””â”€â”€ php/
|   â””â”€â”€ docker-compose.yml
â”‚       
â”‚
â”œâ”€â”€ ui-digital-announce-system/           # Next.js Frontend
â”‚
â”œâ”€â”€ database/                             # MySQL Database
â”‚   â””â”€â”€ docker-compose.yml
â”‚
â”œâ”€â”€ gateway-digital-announce-system/                              # Nginx Gateway
â”‚   â”œâ”€â”€ nginx/ 
|   |   |â”€â”€ certs/
â”‚   â”‚   â””â”€â”€ default.conf    
â”‚   â””â”€â”€ docker-compose.yml
â”‚
â””â”€â”€ assets-digital-announce-system/       # Static Assets Server
    â”œâ”€â”€ nginx/
    â”‚   â””â”€â”€ default.conf    
    â””â”€â”€ docker-compose.yml
```

## ğŸ“¦ Prerequisites

- **Docker Desktop** (installed and running)
- **Git** (to clone repository)
- Required ports:
  - `80` (Gateway)
  - `3000` (UI - internal)
  - `9000` (API - internal)
  - `3306` (MySQL - internal)
  - `8080` (phpMyAdmin)

## âš™ï¸ Installation & Setup

### 1. Clone Repository

```bash
cd c:\Users\fauza\Documents\Kuliah\semester-7\WST\Pertemuan-13
git clone <repository-url> tgs-p13
cd tgs-p13
```

### 2. Setup Hosts File

Add local domain to Windows hosts file:

**File:** `C:\Windows\System32\drivers\etc\hosts`

```
127.0.0.1 pengumuman.test
127.0.0.1 db.pengumuman.test
```

### 3. Create Docker Network

All services use an **external network** `pengumuman-net`. This network must be created first before running any service.

```bash
docker network create pengumuman-net
```

**Explanation:**
- All `docker-compose.yml` files use `external: true` for network
- This means the network must exist beforehand (not automatically created)
- All containers will be connected in the same network
- Enables communication between services using container names

**Verify network:**
```bash
docker network ls | findstr pengumuman-net
```

### 4. Setup Environment Variables

**API (Laravel):**
```bash
cd api-digital-announce-system/digital-announce-system
cp .env.example .env
# Edit .env as needed
```

**Key environment variables:**
```env
DB_HOST=mysql_pengumuman
DB_DATABASE=pengumuman_db
DB_USERNAME=user_pengumuman
DB_PASSWORD=user123
```

## ğŸš€ How to Run

### Service Start Order (IMPORTANT!)

**1. Start Database**
```bash
cd database
docker-compose up -d
```

**2. Start API (Laravel)**
```bash
cd ../api-digital-announce-system/digital-announce-system
docker-compose up -d --build
```

**3. Install Dependencies & Migrate Database**
```bash
# Enter container
docker exec -it laravel_app bash

# Generate key
php artisan key:generate

# Run migrations
php artisan migrate

# Seed data (optional)
php artisan db:seed

# Exit container
exit
```

**4. Start Assets Server**
```bash
cd ../../assets-digital-announce-system
docker-compose up -d
```

**5. Start UI (Next.js)**
```bash
cd ../ui-digital-announce-system/digital-announce-system-fe
docker-compose up -d
```

**6. Start Gateway (Nginx)**
```bash
cd ../../gateway
docker-compose up -d
```

### Verify All Services Running

```bash
docker ps
```

Ensure all the following containers are running:
- `nextjs_ui`
- `laravel_app`
- `db_pengumuman`
- `phpmyadmin_pengumuman`
- `gateway_nginx`
- `assets_nginx`

## ğŸŒ Application Access

| Service | URL | Credentials |
|---------|-----|-------------|
| **Website** | http://pengumuman.test | - |
| **Admin Login** | http://pengumuman.test/login | Email: `admin@example.com`<br>Password: `password` |
| **phpMyAdmin** | http://localhost:8080 | Server: `db_pengumuman`<br>User: `pengumuman_user`<br>Pass: `pengumuman_pass` |

## âœ¨ Application Features

### Public Features
- âœ… View announcement list (with pagination)
- âœ… Read announcement details
- âœ… Search announcements
- âœ… Filter by active status
- âœ… Responsive design (mobile-friendly)

### Admin Features
- âœ… Login/Logout with authentication
- âœ… Dashboard statistics
- âœ… CRUD Announcements
  - Create with rich text editor
  - Upload images
  - Set publish date
  - Toggle active/inactive status
- âœ… Image preview during edit
- âœ… Search & pagination
- âœ… Real-time validation

## ğŸ“š API Documentation

### Authentication Endpoints

**Login**
```http
POST /api/login
Content-Type: application/json

{
  "email": "admin@example.com",
  "password": "password"
}
```

**Logout**
```http
POST /api/logout
Authorization: Bearer {token}
```

### Announcements Endpoints

**Get All Announcements**
```http
GET /api/announcements?page=1&per_page=10&sort_by=created_at&sort_order=desc&search=keyword
```

**Get Single Announcement**
```http
GET /api/announcements/{id}
```

**Create Announcement** (Protected)
```http
POST /api/announcements
Authorization: Bearer {token}
Content-Type: multipart/form-data

{
  "title": "string",
  "content": "html string",
  "publish_at": "2025-12-14",
  "is_active": "1",
  "image": file
}
```

**Update Announcement** (Protected)
```http
POST /api/announcements/{id}
Authorization: Bearer {token}
Content-Type: multipart/form-data

{
  "_method": "PUT",
  "title": "string",
  "content": "html string",
  ...
}
```

**Delete Announcement** (Protected)
```http
DELETE /api/announcements/{id}
Authorization: Bearer {token}
```

## ğŸ”§ Development Workflow

### Install New Dependencies (UI)

```bash
# Do NOT install on Windows host!
# Install ONLY in container:
docker exec -it nextjs_ui npm install <package-name>
```

### View Logs

```bash
# UI logs
docker logs nextjs_ui -f

# API logs
docker logs laravel_app -f

# Database logs
docker logs db_pengumuman -f
```

### Restart Services

```bash
# Restart specific service
docker-compose restart

# Rebuild container (if Dockerfile changes)
docker-compose up -d --build
```

## ğŸ› Troubleshooting

### Error: Network pengumuman-net not found

If this error appears when running `docker-compose up`:
```
ERROR: Network pengumuman-net declared as external, but could not be found
```

**Solution:**
```bash
# Create network first
docker network create pengumuman-net

# Then run again
docker-compose up -d
```

### Container fails to start

```bash
# Check logs
docker logs <container-name>

# Remove and rebuild
docker-compose down
docker-compose up -d --build
```

### Port already in use

```bash
# Check port usage
netstat -ano | findstr :80
netstat -ano | findstr :3306

# Kill process or change port in docker-compose.yml
```

### Database connection error

1. Ensure database service is running
2. Check environment variables in `.env`
3. Ensure containers are connected to the same network

```bash
docker network inspect pengumuman-net
```

### Hot reload not working (UI)

Already configured with:
- `WATCHPACK_POLLING=true`
- `CHOKIDAR_USEPOLLING=true`
- Webpack polling mode

If still not working:
```bash
docker-compose restart
```

## ğŸ“ Notes

- **Node modules:** Stored in Docker volume, no need on host
- **Images:** Stored in `api-digital-announce-system/digital-announce-system/storage/app/public/announcements/`
- **Database:** Persistent data in Docker volume `pengumuman_db_data`

---

Made with â¤ï¸
