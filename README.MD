# Digital Announcement System

Sistem pengumuman digital berbasis web dengan menggunakan Docker, Laravel (API), Next.js (Frontend), MySQL (Database), Nginx (Gateway & Asset Server).

## ğŸ“‹ Daftar Isi

- [Arsitektur Sistem](#arsitektur-sistem)
- [Teknologi Stack](#teknologi-stack)
- [Struktur Project](#struktur-project)
- [Prerequisites](#prerequisites)
- [Instalasi & Setup](#instalasi--setup)
- [Cara Menjalankan](#cara-menjalankan)
- [Fitur Aplikasi](#fitur-aplikasi)
- [API Documentation](#api-documentation)
- [Troubleshooting](#troubleshooting)

## ğŸ—ï¸ Arsitektur Sistem

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      User Browser                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  Gateway (Nginx)       â”‚
         â”‚  pengumuman.test       â”‚
         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚          â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â–¼                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ UI      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ API      â”‚
â”‚ Next.js â”‚   API Calls      â”‚ Laravel  â”‚â”€â”€â”€â”
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â”‚
     â”‚                            â”‚         â”‚
     â”‚                            â–¼         â”‚
     â”‚                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
     â”‚                       â”‚ MySQL   â”‚    â”‚
     â”‚                       â”‚ DB      â”‚    â”‚
     â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
     â”‚                                      â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Assets   â”‚
              â”‚ Nginx    â”‚ (Serve uploaded images)
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Alur Kerja:**
1. **User** â†’ Akses via **Gateway** (pengumuman.test)
2. **Gateway** â†’ Route ke **UI** (page) atau **API** (endpoint)
3. **UI** â†â†’ **API** â†’ Komunikasi untuk CRUD data
4. **API** â†’ **Database** â†’ Simpan/ambil data announcements
5. **API** â†’ **Assets** â†’ Upload gambar announcements
6. **UI** â†’ **Assets** â†’ Load gambar untuk ditampilkan

## ğŸ› ï¸ Teknologi Stack

### Backend (API)
- **Laravel 11** - PHP Framework
- **MySQL 8** - Database
- **Sanctum** - API Authentication

### Frontend (UI)
- **Next.js 16** - React Framework
- **React 19** - UI Library
- **TypeScript** - Type Safety
- **Tailwind CSS** - Styling
- **Axios** - HTTP Client
- **React-Quill-New** - Rich Text Editor

### Infrastructure
- **Docker & Docker Compose** - Containerization
- **Nginx** - Reverse Proxy & Static File Server
- **phpMyAdmin** - Database Management

## ğŸ“ Struktur Project

```
tgs-p13/
â”œâ”€â”€ api-digital-announce-system/          # Laravel API Backend
â”‚   â””â”€â”€ digital-announce-system/
|   â””â”€â”€ nginx/
|       â””â”€â”€ default.conf
|   â””â”€â”€ php/
|   â””â”€â”€ docker-compose.yml
â”‚       
â”‚
â”œâ”€â”€ ui-digital-announce-system/           # Next.js Frontend
â”‚
â”œâ”€â”€ database/                             # MySQL Database
â”‚   â””â”€â”€ docker-compose.yml
â”‚
â”œâ”€â”€ gateway-digital-announce-system/                              # Nginx Gateway
â”‚   â”œâ”€â”€ nginx/ 
|   |   |â”€â”€ certs/
â”‚   â”‚   â””â”€â”€ default.conf    
â”‚   â””â”€â”€ docker-compose.yml
â”‚
â””â”€â”€ assets-digital-announce-system/       # Static Assets Server
    â”œâ”€â”€ nginx/
    â”‚   â””â”€â”€ default.conf    
    â””â”€â”€ docker-compose.yml
```

## ğŸ“¦ Prerequisites

- **Docker Desktop** (sudah terinstall dan running)
- **Git** (untuk clone repository)
- Port yang diperlukan:
  - `80` (Gateway)
  - `3000` (UI - internal)
  - `9000` (API - internal)
  - `3306` (MySQL - internal)
  - `8080` (phpMyAdmin)

## âš™ï¸ Instalasi & Setup

### 1. Clone Repository

```bash
cd c:\Users\fauza\Documents\Kuliah\semester-7\WST\Pertemuan-13
git clone <repository-url> tgs-p13
cd tgs-p13
```

### 2. Setup Hosts File

Tambahkan domain lokal ke file hosts Windows:

**File:** `C:\Windows\System32\drivers\etc\hosts`

```
127.0.0.1 pengumuman.test
127.0.0.1 db.pengumuman.test
```

### 3. Buat Docker Network

Semua services menggunakan **external network** `pengumuman-net`. Network ini harus dibuat terlebih dahulu sebelum menjalankan service apapun.

```bash
docker network create pengumuman-net
```

**Penjelasan:**
- Semua `docker-compose.yml` menggunakan `external: true` untuk network
- Artinya network harus sudah ada sebelumnya (tidak dibuat otomatis)
- Semua container akan terhubung dalam satu network yang sama
- Memungkinkan komunikasi antar services menggunakan container name

**Verifikasi network:**
```bash
docker network ls | findstr pengumuman-net
```

### 4. Setup Environment Variables

**API (Laravel):**
```bash
cd api-digital-announce-system/digital-announce-system
cp .env.example .env
# Edit .env sesuai kebutuhan
```

**Key environment variables:**
```env
DB_HOST=mysql_pengumuman
DB_DATABASE=pengumuman_db
DB_USERNAME=user_pengumuman
DB_PASSWORD=user123
```

## ğŸš€ Cara Menjalankan

### Urutan Start Services (PENTING!)

**1. Start Database**
```bash
cd database
docker-compose up -d
```

**2. Start API (Laravel)**
```bash
cd ../api-digital-announce-system/digital-announce-system
docker-compose up -d --build
```

**3. Install Dependencies & Migrate Database**
```bash
# Masuk ke container
docker exec -it laravel_app bash

# Generate key
php artisan key:generate

# Run migrations
php artisan migrate

# Seed data (optional)
php artisan db:seed

# Exit container
exit
```

**4. Start Assets Server**
```bash
cd ../../assets-digital-announce-system
docker-compose up -d
```

**5. Start UI (Next.js)**
```bash
cd ../ui-digital-announce-system/digital-announce-system-fe
docker-compose up -d
```

**6. Start Gateway (Nginx)**
```bash
cd ../../gateway
docker-compose up -d
```

### Verifikasi Semua Services Running

```bash
docker ps
```

Pastikan semua container berikut running:
- `nextjs_ui`
- `laravel_app`
- `db_pengumuman`
- `phpmyadmin_pengumuman`
- `gateway_nginx`
- `assets_nginx`

## ğŸŒ Akses Aplikasi

| Service | URL | Credentials |
|---------|-----|-------------|
| **Website** | http://pengumuman.test | - |
| **Admin Login** | http://pengumuman.test/login | Email: `admin@example.com`<br>Password: `password` |
| **phpMyAdmin** | http://localhost:8080 | Server: `db_pengumuman`<br>User: `pengumuman_user`<br>Pass: `pengumuman_pass` |

## âœ¨ Fitur Aplikasi

### Public Features
- âœ… Lihat daftar pengumuman (dengan pagination)
- âœ… Baca detail pengumuman
- âœ… Search pengumuman
- âœ… Filter berdasarkan status aktif
- âœ… Responsive design (mobile-friendly)

### Admin Features
- âœ… Login/Logout dengan authentication
- âœ… Dashboard statistik
- âœ… CRUD Announcements
  - Create dengan rich text editor
  - Upload gambar
  - Set publish date
  - Toggle status aktif/inaktif
- âœ… Preview gambar saat edit
- âœ… Search & pagination
- âœ… Real-time validation

## ğŸ“š API Documentation

### Authentication Endpoints

**Login**
```http
POST /api/login
Content-Type: application/json

{
  "email": "admin@example.com",
  "password": "password"
}
```

**Logout**
```http
POST /api/logout
Authorization: Bearer {token}
```

### Announcements Endpoints

**Get All Announcements**
```http
GET /api/announcements?page=1&per_page=10&sort_by=created_at&sort_order=desc&search=keyword
```

**Get Single Announcement**
```http
GET /api/announcements/{id}
```

**Create Announcement** (Protected)
```http
POST /api/announcements
Authorization: Bearer {token}
Content-Type: multipart/form-data

{
  "title": "string",
  "content": "html string",
  "publish_at": "2025-12-14",
  "is_active": "1",
  "image": file
}
```

**Update Announcement** (Protected)
```http
POST /api/announcements/{id}
Authorization: Bearer {token}
Content-Type: multipart/form-data

{
  "_method": "PUT",
  "title": "string",
  "content": "html string",
  ...
}
```

**Delete Announcement** (Protected)
```http
DELETE /api/announcements/{id}
Authorization: Bearer {token}
```

## ğŸ”§ Development Workflow

### Install Dependency Baru (UI)

```bash
# Jangan install di host Windows!
# Install HANYA di container:
docker exec -it nextjs_ui npm install <package-name>
```

### Lihat Logs

```bash
# UI logs
docker logs nextjs_ui -f

# API logs
docker logs laravel_app -f

# Database logs
docker logs db_pengumuman -f
```

### Restart Services

```bash
# Restart specific service
docker-compose restart

# Rebuild container (jika ada perubahan Dockerfile)
docker-compose up -d --build
```

## ğŸ› Troubleshooting

### Error: Network pengumuman-net not found

Jika muncul error saat `docker-compose up`:
```
ERROR: Network pengumuman-net declared as external, but could not be found
```

**Solusi:**
```bash
# Buat network terlebih dahulu
docker network create pengumuman-net

# Lalu jalankan ulang
docker-compose up -d
```

### Container tidak bisa start

```bash
# Check logs
docker logs <container-name>

# Remove dan rebuild
docker-compose down
docker-compose up -d --build
```

### Port sudah digunakan

```bash
# Check port usage
netstat -ano | findstr :80
netstat -ano | findstr :3306

# Kill process atau ganti port di docker-compose.yml
```

### Database connection error

1. Pastikan database service sudah running
2. Check environment variables di `.env`
3. Pastikan container terhubung ke network yang sama

```bash
docker network inspect pengumuman-net
```

### Hot reload tidak bekerja (UI)

Sudah dikonfigurasi dengan:
- `WATCHPACK_POLLING=true`
- `CHOKIDAR_USEPOLLING=true`
- Webpack polling mode

Jika masih tidak bekerja:
```bash
docker-compose restart
```

## ğŸ“ Notes

- **Node modules:** Disimpan di Docker volume, tidak perlu ada di host
- **Gambar:** Disimpan di `api-digital-announce-system/digital-announce-system/storage/app/public/announcements/`
- **Database:** Data persistent di Docker volume `pengumuman_db_data`

---

Made with â¤ï¸
